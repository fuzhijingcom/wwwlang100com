(function(c){"function"!=typeof c.cookie&&c.getScript("http://style.org.hc360.cn/js/build/source/widgets/jquery.cookie.js");c.fn.searchModule=function(b){(new h(this,b)).init()};var h=function(b,a){this.defaultConfig={className:"",searchTotal:1,searchOur:0,shopOurUrl:"",checkNavShow:0,userlogs:{input:"",searchCookie:"",searchLink:"",ourBtn:"",allBtn:""}};this.menuIndex=-1;this.config=c.extend({},this.defaultConfig,a);this.searchInterface="http://s.hc360.com/cgi-bin/checkword";this.wrap=c(b)};h.prototype=
{constructor:h,init:function(){var b=c("input.inptaa").val();0<c.trim(b).length&&"\u8bf7\u8f93\u5165\u5173\u952e\u8bcd"!=b&&(this.defaultValue=b);this.createHtml();this.bindEvent()},createHtml:function(){var b=this.config,a='<div class="'+b.className+'">',a=a+'<form name="searchform" method="get" target="_blank" action="http://s.hc360.com">',a=a+'<div class="searchBox">';b.checkNavShow&&b.tabNav&&(a+='<div class="s_trigger" data-query="searchType">',a+='<span data-query="searchNode" defaultvalue="\u8bf7\u8f93\u5165\u4ea7\u54c1\u540d\u79f0">\u4f9b\u5e94</span>',
a+='<span class="tri"></span>',a+="</div>",a+='<div class="s_options" style="display: none;" data-query="searchList">',c.each(b.tabNav,function(b,c){a+=' <a href="javascript:;" data-id="'+c.id+'" data-value="'+c.defaultValue+'">'+c.name+"</a>"}),a+="</div>");a+=' <div class="seaInputBox"><p id="defaultValue">\u8bf7\u8f93\u5165\u4ea7\u54c1\u540d\u79f0</p><input name="mc" value="seller" type="hidden" data-query="mc"><input type="text" value="'+("undefined"!=typeof this.defaultValue?this.defaultValue:
"")+'" maxlength="50" autocomplete="off" size="30" name="w" '+b.userlogs.input+' data-query="inputValue"></div>';b.searchTotal&&(a+='<label><button type="button" id="searchAll" '+b.userlogs.allBtn+">\u641c\u5168\u7ad9</button></label>");a+=' <div class="form_list_tip" style="display: none;"> <ul></ul><div class="form_advice">\u5efa\u8bae\u641c\u7d22\uff1a\u5e2e\u60a8\u9009\u62e9\u66f4\u7cbe\u51c6\u7684\u5173\u952e\u8bcd</div></div>';a+=' <div class="RecordBox" style="display:none;"></div></div>';
b.searchOur&&(a+='<div class="seaTbtn"><button type="button" id="searchOur"'+b.userlogs.ourBtn+">\u641c\u672c\u5e97</button></div>");a+="</form></div>";this.wrap.html(a);this.input=c('[data-query="inputValue"]');this._defaulBox=c("#defaultValue");0<this.input.val().length&&this._defaulBox.hide()},bindEvent:function(){var b=this,a=b.config;a.checkNavShow&&a.tabNav&&this.searchTypeEvent();c("#defaultValue").click(function(){b.input.focus()});b.input.on("keyup",function(a){var d=b.input.val(),f=c("#defaultValue"),
g=b.getSearchVal(),j=a.keyCode;0==d.length?(f.html(g).show(),c(".form_list_tip").hide(),b.menuIndex=-1,c(".RecordBox").show()):f.hide();b.timer&&clearTimeout(b.timer);b.timer=setTimeout(function(){var a=c.trim(b.input.val());0<a.length&&-1==c.inArray(j,[40,38,13])&&b.getSearchDom(a)},180)}).on("keydown",function(a){var c=a.keyCode;40==c?b.resetMenu("down",a):38==c?b.resetMenu("up",a):13==c&&(b.submitForm(0),a.preventDefault?a.preventDefault():a.returnVal=!1)});c(".seaInputBox,.RecordBox").hover(function(){b.input.focus();
b.menuIndex=-1;c("#defaultValue").is(":visible")&&c(".RecordBox").is(":hidden")&&(c(".form_list_tip").hide(),b.searchCookieHtml())},function(){c(".RecordBox").hide()});b.wrap.on("click",".form_list_tip ul li,.RecordBox li",function(a){b._defaulBox.hide();b.input.val(c(this).find("a").html());b.submitForm(0);a.preventDefault()});c("body").on("click",function(a){c(a.target).is('[data-query="inputValue"]')||(c(".form_list_tip").hide(),b.menuIndex=-1)});b.wrap.on("click","button",function(){var e=c(this);
e.is("#searchAll")?(b.submitForm(0),a.userlogs.cognos&&a.userlogs.cognos.button&&HC.UBA.sendUserlogsElement(a.userlogs.cognos.button[0])):e.is("#searchOur")&&(b.submitForm(1),a.userlogs.cognos&&a.userlogs.cognos.button&&HC.UBA.sendUserlogsElement(a.userlogs.cognos.button[1]))})},searchCookieHtml:function(){if("function"==typeof c.cookie){var b=c.cookie("searchWord");if("undefined"!=typeof b){for(var b=b.split(","),a="<ul>",e=1,d=b.length-1;0<=d&&!(10<e);d--)e++,a+='<li><a href="#" target="_blank" '+
this.config.userlogs.searchCookie+">"+b[d]+"</a></li>";c(".RecordBox").html(a+"</ul>").show()}else c(".RecordBox").hide()}},resetMenu:function(b){var a;if(c(".RecordBox ul").is(":visible"))a=c(".RecordBox ul li");else if(c(".form_list_tip ul").is(":visible"))a=c(".form_list_tip ul li");else return!1;var e=a.length-1;"up"==b?1>this.menuIndex?this.menuIndex=e:this.menuIndex--:"down"==b&&(this.menuIndex==e?this.menuIndex=0:this.menuIndex++);b=a.eq(this.menuIndex);b.addClass("cur").siblings().removeClass("cur");
c("#defaultValue").hide();this.input.val(b.find("a").html()).focus()},getSearchDom:function(b){var a=this;c.ajax({url:a.searchInterface,data:{type:1,searchtype:1,w:b},type:"GET",dataType:"jsonp",jsonp:"jsoncallback",timeout:3E3}).done(function(b){b=b.words;var d=[],f=a.wrap.find(".form_list_tip");if(0<b.length){for(var g=10<b.length?10:b.length,j=0;j<g;j++){var h=b[j];d.push("<li><span>\u7ea6"+h.resultnum+'\u4e2a\u7ed3\u679c</span><a href="#" '+a.config.userlogs.searchLink+'title="'+decodeURIComponent(h.keyword)+
'">'+decodeURIComponent(h.keyword)+"</a></li>")}f.find("ul").html(d.join(""));c(".RecordBox").hide();f.show()}else f.find("ul").html(d.join("")),f.hide(),c(".RecordBox").hide()})},submitForm:function(b){var a=c('[name="searchform"]',this.wrap),e=this.input.val();this.setCookie("searchWord",e,100);c('[data-query="searchNode"]').attr("mc");if(0==c.trim(e).length)return window.location=location,!1;b&&a.attr({action:this.config.shopOurUrl+"&w="+encodeURIComponent(e),target:"_self"});a.submit()},getSearchVal:function(){var b=
this.config,a="\u8bf7\u8f93\u5165\u4ea7\u54c1\u540d\u79f0";b.checkNavShow&&b.tabNav&&(b=c('[data-query="searchNode"]').attr("defaultValue"),0<b.length&&(a=b));return a},setCookie:function(b,a,e){if(0==c.trim(a).length)return!1;if("function"==typeof c.cookie){var d=c.cookie(b);if("undefined"!=typeof d){for(var f=d.split(","),g=0;g<f.length;g++)if(a==f[g])return!1;a=d+","+a}c.cookie(b,a,{expires:e,path:"/",domain:".hc360.com"})}},searchTypeEvent:function(){var b=c('[data-query="searchList"]'),a=c("#defaultValue");
c('[data-query="searchType"]').click(function(){b.show()});var e=c.map(this.config.tabNav,function(a){return a.defaultValue});b.on("click","a",function(){var d=c(this),f=d.attr("data-value"),g=d.attr("data-id"),d=d.html();c('[data-query="searchNode"]').html(d).attr({defaultValue:f,mc:g});c('[data-query="mc"]').val(g);b.hide();0<=c.inArray(a.html(),e)&&a.html(f)})}}})(jQuery);
