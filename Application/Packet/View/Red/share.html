<html>
<title>分享到朋友圈，领取红包</title>
<script src="http://wx.huipu.org/template/mobile/new2/static/js/jquery-3.1.1.min.js" type="text/javascript" charset="utf-8"></script>
<script src="http://wx.huipu.org/template/mobile/new2/static/js/style.js" type="text/javascript" charset="utf-8"></script>
<script src="http://wx.huipu.org/template/mobile/new2/static/js/mobile-util.js" type="text/javascript" charset="utf-8"></script>
<script src="http://wx.huipu.org/template/mobile/new2/static/js/global.js"></script>
<script src="http://wx.huipu.org/template/mobile/new2/static/js/layer.js"  type="text/javascript" ></script>
<script src="http://wx.huipu.org/template/mobile/new2/static/js/swipeSlide.min.js" type="text/javascript" charset="utf-8"></script>

<body>

哈哈哈哈<br>

{$sharelink}

<br>

{$shareimgurl}

<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script src="http://wx.huipu.org/public/js/global.js"></script>

<script type="text/javascript">

   var ShareLink = "{$sharelink}"; //默认分享链接
   var ShareImgUrl = "{$shareimgurl}"; // 分享图标



var user_id = "{$user_id}"; // 当前用户id
//alert(is_distribut+'=='+user_id);
								
ShareLink = ShareLink + "?share_id="+user_id;									


$(function() {
	//isWeiXin() 
	if( user_id > 0 ){
		//location.href.split('#')[0]
		
		/*
		$.ajax({
			type : "POST",
			url:"http://wx.huipu.org/index.php?m=Mobile&c=Index&a=ajaxGetWxConfig&t="+Math.random(),
			data:{'askUrl':encodeURIComponent("http://packet.lang100.com/red/share")},		
			dataType:'JSON',
			success: function(res)
			{
				alert(res);
				//微信配置
				wx.config({
				    debug: false, 
				    appId: res.appId,
				    timestamp: res.timestamp, 
				    nonceStr: res.nonceStr, 
				    signature: res.signature,
				    jsApiList: ['onMenuShareTimeline', 'onMenuShareAppMessage','onMenuShareQQ','onMenuShareQZone','hideOptionMenu'] // 功能列表，我们要使用JS-SDK的什么功能
				});
			},
			error:function(){
				alert('error');
				return false;
			}
		}); 
		*/
		
		/*
		//微信配置
		wx.config({
		    debug: false, 
		    appId: "{$res.appId}",
		    timestamp: "{$res.timestamp}", 
		    nonceStr: "{$res.nonceStr}", 
		    signature: "{$res.signature}",
		    jsApiList: ['onMenuShareTimeline', 'onMenuShareAppMessage','onMenuShareQQ','onMenuShareQZone','hideOptionMenu'] // 功能列表，我们要使用JS-SDK的什么功能
		});
			
*/
//微信配置
wx.config({
    debug: false, 
    appId: "wxbd43b61644000ecf",
    timestamp: "1508734180", 
    nonceStr: "tIVXaZ2GQOUTUhnV", 
    signature: "d6f9d0ea2776740d8b6618029dd54fa2f4bdcfc3",
    jsApiList: ['onMenuShareTimeline', 'onMenuShareAppMessage','onMenuShareQQ','onMenuShareQZone','hideOptionMenu'] // 功能列表，我们要使用JS-SDK的什么功能
});
		//alert(ShareLink);
		
		
		// config信息验证后会执行ready方法，所有接口调用都必须在config接口获得结果之后，config是一个客户端的异步操作，所以如果需要在 页面加载时就调用相关接口，则须把相关接口放在ready函数中调用来确保正确执行。对于用户触发时才调用的接口，则可以直接调用，不需要放在ready 函数中。
		wx.ready(function(){
		    // 获取"分享到朋友圈"按钮点击状态及自定义分享内容接口
		    wx.onMenuShareTimeline({
		        title: "标题", // 分享标题
		        link:ShareLink,
		        imgUrl:ShareImgUrl // 分享图标
		    });

		    // 获取"分享给朋友"按钮点击状态及自定义分享内容接口
		    wx.onMenuShareAppMessage({
		        title: "标题", // 分享标题
		        desc: "琅百商城", // 分享描述
		        link:ShareLink,
		        imgUrl:ShareImgUrl // 分享图标
		    });
			// 分享到QQ
			wx.onMenuShareQQ({
		        title: "标题", // 分享标题
		        desc: "琅百商城", // 分享描述
		        link:ShareLink,
		        imgUrl:ShareImgUrl // 分享图标
			});	
			// 分享到QQ空间
			wx.onMenuShareQZone({
		        title: "标题", // 分享标题
		        desc: "琅百商城", // 分享描述
		        link:ShareLink,
		        imgUrl:ShareImgUrl // 分享图标
			});

		   <if condition="CONTROLLER_NAME eq 'User'"> 
				wx.hideOptionMenu();  // 用户中心 隐藏微信菜单
		   </if>	
		});
	}
});

function isWeiXin(){
    var ua = window.navigator.userAgent.toLowerCase();
    if(ua.match(/MicroMessenger/i) == 'micromessenger'){
        return true;
    }else{
        return false;
    }
}
</script>
<!--微信关注提醒 start-->
<if condition="$Think.session.subscribe eq 0"></if>
<button class="guide" style="display:none;" onclick="follow_wx()">关注公众号</button>
<style type="text/css">
.guide{width:1rem;height:4rem;text-align: center;border-radius: 0.2rem ;font-size:0.5rem;padding:0.2rem 0;border:1px solid #adadab;color:#000000;background-color: #fff;position: fixed;right: 0.1rem;bottom: 10rem;}
#cover{display:none;position:absolute;left:0;top:0;z-index:18888;background-color:#000000;opacity:0.7;}
#guide{display:none;position:absolute;top:0.1rem;z-index:19999;}
#guide img{width: 70%;height: auto;display: block;margin: 0 auto;margin-top: 0.2rem;}
</style>
<script type="text/javascript">
  //关注微信公众号二维码	 
function follow_wx()
{
	layer.open({
		type : 1,  
		title: '关注公众号',
		content: '<img src="{$wx_qr}" width="100%">',
		style: ''
	});
}
  
$(function(){
	if(isWeiXin()){
		var subscribe = getCookie('subscribe'); // 是否已经关注了微信公众号		
		if(subscribe == 0)
			$('.guide').show();
	}else{
		$('.guide').hide();
	}
})
 
</script> 

<!--微信关注提醒  end-->

</body>
</html>